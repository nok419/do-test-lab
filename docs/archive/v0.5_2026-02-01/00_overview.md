# 概要（ゼロベースの整理）

## ミッション
実験用Webアプリを外部公開するための「共通の土壌」を作る。

- 学生が各々で実験用Webアプリを作っている
- しかし、外部公開の標準環境・手順・安全策が未整備
- その結果「毎回個別に頑張る」「研究室ネットワークを晒すリスク」「保守不能」が起きがち

---

## 推奨アーキテクチャ（結論）
**Cloudflare（入口） + DigitalOcean App Platform（アプリ実行） + Managed DB + Spaces** を基本形にします。

理由（要点）：
- AWSより概念が少なく、UIで完結しやすい（学習コストを抑えやすい）
- Git連携でデプロイでき、保守対象（OS/ミドル）を減らせる
- DB/ストレージをマネージドに寄せて「バックアップ・障害対応の最低限」が作りやすい

---

## 役割分担（運用が回る最小単位）

### Platform Admin（研究室の運用担当）
- Cloudflare（ゾーン、DNS、TLS、最低限のルール）
- DigitalOcean（Team/Project、Spaces、Managed DB、共通監視の型）
- 予算上限の管理、不要アプリの停止/アーカイブ判断

### App Owner（学生・開発者）
- テンプレからアプリ作成
- GitHub push → App Platformでデプロイ
- アプリ内の認証・権限制御（「参加者が見える範囲」と「研究室だけが見える範囲」の分離）
- 研究で必要なログ/データの保存方針の決定（DB / Spaces）

---

## まず何を作ってテストすべきか（Smoke Test）
最初の1本は「機能」より **土台の健全性** を確認します。

**Smoke Testで必ず確認する項目**
1. `/health` が200で返る（外形監視の対象）
2. DB接続の死活確認ができる（例：`/health/db`）
3. 認証（ログイン）→ 役割ベース制御（RBAC）が動く
4. Spacesへアップロード（署名付きURL等）できる
5. 日次バックアップ（pg_dump → Spaces）と復旧手順が通る
6. 監視（Uptime）で落ちたら通知が来る

このバンドルには `smoketest/fastapi-smoketest/` が入っています。

---

## 用語メモ（UIが英語でも詰まらないための最低限）
- **App Platform**: Git連携でアプリ（Web/Worker/Job）を動かすPaaS
- **Managed PostgreSQL**: DBをマネージドで提供（バックアップ/運用が楽）
- **Spaces**: S3互換オブジェクトストレージ（ファイル/バックアップ置き場）
- **Uptime**: URLを定期チェックする外形監視（Slack/Email通知）
