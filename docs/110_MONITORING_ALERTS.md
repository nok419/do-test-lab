# 監視と通知（最低限から始める）

最終更新: 2026-02-03

---

## 1. 基本方針
- まずは **“落ちたら分かる”** を作る（Uptime + デプロイ失敗通知）
- 次に **“戻せる”** を作る（バックアップと復旧訓練）
- 監視の運用コストが高くなりすぎないよう、段階導入する

---

## 2. 通知先（まずここを固める）
### 2.1 DigitalOcean の通知先
- Team Contact Email（共同メアド）に集約する  
  - デプロイ失敗
  - SSL更新通知
  - 障害/メンテナンス通知 等

### 2.2 追加通知（任意）
- Slack/Chat 等に飛ばしたい場合は、運用チームの導線を1つにする  
  （メールもSlackも別々に見る運用は破綻しやすい）

---

## 3. 監視項目（標準）
### 3.1 外形監視（必須）
- 対象: `GET /health`
- 間隔: 1〜5分
- 失敗時: Platform Ops に通知

### 3.2 ドメイン/デプロイ失敗（必須）
App Platform Alerts:
- DEPLOYMENT_FAILED
- DOMAIN_FAILED

### 3.3 DB死活（任意）
- `GET /health/db` を用意している場合、別監視にすることもできる  
  ただし DB 障害が “短期的” に多い場合は、通知疲れに注意。

---

## 4. バックアップ監視（最低限のやり方）
バックアップは「毎日失敗を通知」より、次の運用が現実的です。

- production:
  - 週1で「直近7日分のdumpがあること」を確認
  - go-live 前に restore 訓練を通す
- 重要実験:
  - Job失敗時に即通知（運用負荷は上がる）

---

## 5. ダッシュボード/台帳
台帳（`ops/templates/resource_inventory.csv`）に以下を残す：
- アプリ名・サブドメイン
- Uptime監視URL
- DB/Spacesの関連
- バックアップprefix
- 担当者（App Owner）

---

## 6. 次にやること
- 障害対応手順: `140_RUNBOOKS.md`
- コスト監視: `130_COST_GUARDRAILS.md`
