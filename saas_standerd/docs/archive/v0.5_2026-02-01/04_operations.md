# 運用（最小で回すためのルール）

## 1) アプリに必須の「共通インタフェース」
全アプリ共通で入れる（テンプレ準拠）：
- `/health` : 200を返すだけ（外形監視の基点）
- ログ出力（stdout/stderr）
- 設定は環境変数（Secretsは暗号化）
- 永続化は **DB/Spacesのみ**（ローカルディスクに置かない）

---

## 2) 監視（コスト最小）
- App Platform: デプロイ失敗アラート
- Uptime: `/health` を1分〜5分間隔で監視
- DB: 可能なら簡易に `GET /health/db` を残して切り分けに使う

---

## 3) バックアップ（最低限）
- Managed DBの自動バックアップは利用（ただし「論理バックアップ」を別で持つと安心）
- 追加で `pg_dump` を日次でSpacesに退避（scriptあり）

推奨：
- 世代保持: 7日〜30日（予算と復旧要件で調整）

---

## 4) 復旧訓練（必須）
運用開始前に1回だけでも良いので必ずやる：
- バックアップ → 別DBに復元 → アプリ起動確認
- 「壊しても戻る」自信がある状態を作る

---

## 5) アーカイブ（実験が終わったら）
- App Platform App: 停止/削除（必要ならスナップショット）
- DB: dumpをSpacesに残す
- Spaces: 必要な成果物のみ残して整理（コスト管理）

